<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogue - Chem Spot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        header { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 15px 0; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo-section { display: flex; align-items: center; gap: 10px; }
        .logo { height: 40px; }
        .logo-text { font-size: 1.5rem; font-weight: 700; color: #4F46E5; }
        
        .nav-menu { display: flex; list-style: none; gap: 30px; }
        .nav-link { text-decoration: none; color: #374151; font-weight: 500; }
        .nav-link.active { color: #4F46E5; }
        
        .hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 0; text-align: center; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 15px; }
        .hero p { font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9; }
        
        .search-bar { max-width: 500px; margin: 0 auto; display: flex; background: white; border-radius: 25px; overflow: hidden; }
        .search-bar input { flex: 1; padding: 15px 20px; border: none; font-size: 1rem; outline: none; }
        .search-bar button { background: #4F46E5; color: white; border: none; padding: 15px 20px; cursor: pointer; }
        
        .results-section { padding: 40px 0; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .results-info { font-size: 1.1rem; color: #374151; font-weight: 600; }
        
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .product-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 20px; transition: transform 0.3s; }
        .product-card:hover { transform: translateY(-5px); }
        
        .product-name { font-size: 1.2rem; font-weight: 600; color: #1f2937; margin-bottom: 10px; }
        .product-category { background: #eff6ff; color: #1e40af; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem; display: inline-block; margin-bottom: 15px; }
        .product-details { margin-bottom: 15px; }
        .detail-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; }
        .detail-row .label { color: #6b7280; }
        .detail-row .value { color: #374151; font-weight: 600; }
        .product-price { font-size: 1.3rem; font-weight: 700; color: #4F46E5; margin-bottom: 15px; }
        
        .btn-quote { background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: 600; }
        .btn-quote:hover { background: #059669; }
        .btn-quote:disabled { background: #9ca3af; cursor: not-allowed; }
        
        .status { position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 6px; color: white; font-weight: 600; z-index: 1000; }
        .status.success { background: #10b981; }
        .status.error { background: #ef4444; }
        .status.loading { background: #3b82f6; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
        .empty-state i { font-size: 3rem; margin-bottom: 20px; opacity: 0.5; }
        .empty-state h3 { font-size: 1.5rem; margin-bottom: 10px; color: #374151; }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/chemspotV1-dt6tDoOKp1wAyi8oRMzxzufIVBfiu9.png" alt="Chem Spot Logo" class="logo">
                    <span class="logo-text">Chem Spot</span>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Accueil</a></li>
                    <li><a href="catalogue.html" class="nav-link active">Catalogue</a></li>
                    <li><a href="fournisseurs.html" class="nav-link">Fournisseurs</a></li>
                    <li><a href="contact.html" class="nav-link">Contact</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <div class="container">
            <h1>Notre Catalogue</h1>
            <p>Découvrez notre sélection de matières premières pharmaceutiques</p>
            
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Rechercher un produit...">
                <button onclick="search()"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </section>

    <!-- Results -->
    <section class="results-section">
        <div class="container">
            <div class="results-header">
                <div class="results-info">
                    <span id="resultsCount">Chargement des produits...</span>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <!-- Produits chargés ici -->
            </div>
        </div>
    </section>

    <script>
        const SUPABASE_URL = 'https://jkaffpgqbyhuihvyvtld.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImprYWZmcGdxYnlodWlodnl2dGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2NTgzOTQsImV4cCI6MjA2NzIzNDM5NH0.OIjoz6uoPV25Nraral4YN_gz7q6COBW3dAVIYhBy1pI';

        let supabase;
        let allProducts = [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', async () => {
            showStatus('Initialisation en cours...', 'loading');
            
            try {
                // Attendre Supabase
                let attempts = 0;
                while (typeof window.supabase === 'undefined' && attempts < 10) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    attempts++;
                }
                
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase non chargé');
                }
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                showStatus('Chargement des produits...', 'loading');
                
                await loadProducts();
                
            } catch (error) {
                console.error('Erreur:', error);
                showStatus('Erreur de chargement', 'error');
                loadFallbackProducts();
            }
        });

        // Charger les produits
        async function loadProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('pharma_products')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                allProducts = products || [];
                displayProducts();
                updateCount();
                
                showStatus(`${allProducts.length} produits chargés !`, 'success');
                
            } catch (error) {
                console.error('Erreur Supabase:', error);
                throw error;
            }
        }

        // Afficher les produits
        function displayProducts() {
            const grid = document.getElementById('productsGrid');
            
            if (allProducts.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Aucun produit trouvé</h3>
                        <p>Les produits sont en cours de chargement...</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = allProducts.map(product => createProductCard(product)).join('');
        }

        // Créer une carte produit
        function createProductCard(product) {
            const name = product.name || 'Produit sans nom';
            const price = product.price || 'Prix sur demande';
            const category = product.category || 'Non catégorisé';
            const stock = product.stock || 0;
            const manufacturer = product.manufacturer || 'Fabricant non spécifié';
            
            return `
                <div class="product-card">
                    <div class="product-name">${name}</div>
                    <div class="product-category">${category}</div>
                    
                    <div class="product-details">
                        <div class="detail-row">
                            <span class="label">Fabricant:</span>
                            <span class="value">${manufacturer}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Stock:</span>
                            <span class="value">${stock} unités</span>
                        </div>
                    </div>
                    
                    <div class="product-price">${price}€</div>
                    
                    <button class="btn-quote" onclick="requestQuote(${product.id})" ${stock === 0 ? 'disabled' : ''}>
                        <i class="fas fa-envelope"></i> Demander un devis
                    </button>
                </div>
            `;
        }

        // Produits de fallback
        function loadFallbackProducts() {
            allProducts = [
                {
                    id: 1,
                    name: 'Paracétamol USP 500mg',
                    category: 'Analgésique',
                    price: 15.20,
                    manufacturer: 'PharmaPlus',
                    stock: 850
                },
                {
                    id: 2,
                    name: 'Aspirine API 99%',
                    category: 'Analgésique',
                    price: 22.40,
                    manufacturer: 'MediCorp',
                    stock: 720
                },
                {
                    id: 3,
                    name: 'Ibuprofène Ph.Eur',
                    category: 'Anti-inflammatoire',
                    price: 28.90,
                    manufacturer: 'EuroPharma',
                    stock: 0
                }
            ];
            
            displayProducts();
            updateCount();
            showStatus('Mode test - 3 produits', 'error');
        }

        // Fonctions utilitaires
        function updateCount() {
            document.getElementById('resultsCount').textContent = 
                `${allProducts.length} produit${allProducts.length > 1 ? 's' : ''} trouvé${allProducts.length > 1 ? 's' : ''}`;
        }

        function search() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (!query) {
                displayProducts();
                return;
            }
            
            const filtered = allProducts.filter(product => 
                product.name.toLowerCase().includes(query) ||
                product.category.toLowerCase().includes(query) ||
                product.manufacturer.toLowerCase().includes(query)
            );
            
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = filtered.map(product => createProductCard(product)).join('');
            
            document.getElementById('resultsCount').textContent = 
                `${filtered.length} produit${filtered.length > 1 ? 's' : ''} trouvé${filtered.length > 1 ? 's' : ''}`;
        }

        function requestQuote(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (product) {
                alert(`Demande de devis pour: ${product.name}\nPrix: ${product.price}€\n\nFonctionnalité en cours de développement.`);
            }
        }

        function showStatus(message, type) {
            // Supprimer les anciens status
            document.querySelectorAll('.status').forEach(el => el.remove());
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            
            if (type !== 'loading') {
                setTimeout(() => statusDiv.remove(), 4000);
            }
        }
    </script>
</body>
</html>
