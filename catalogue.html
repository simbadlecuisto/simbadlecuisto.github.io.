<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogue - ChemistrySpot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/responsive.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/chemspotV1-dt6tDoOKp1wAyi8oRMzxzufIVBfiu9.png" alt="ChemistrySpot Logo" class="logo">
                    <span class="logo-text">ChemistrySpot</span>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Accueil</a></li>
                    <li><a href="catalogue.html" class="nav-link active">Catalogue</a></li>
                    <li><a href="fournisseurs.html" class="nav-link">Fournisseurs</a></li>
                    <li><a href="contact.html" class="nav-link">Contact</a></li>
                </ul>
                
                <div class="header-actions">
                    <button class="btn btn-outline btn-sm">
                        <i class="fas fa-shopping-cart"></i> Panier (0)
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <div class="page-header-content">
                <h1>üì¶ Catalogue Excipients</h1>
                <p>Explorez notre gamme compl√®te d'excipients pharmaceutiques</p>
                
                <!-- Barre de recherche -->
                <div class="search-container" style="max-width: 700px; margin: 2rem auto 0;">
                    <form class="search-form" onsubmit="handleSearch(event)">
                        <div class="search-input-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="catalogSearchInput" placeholder="Rechercher par nom, CAS, formule..." autocomplete="off">
                        </div>
                        <button type="submit">
                            <i class="fas fa-search"></i> Rechercher
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Catalogue -->
    <section class="section section-white">
        <div class="container">
            <!-- Stats rapides -->
            <div class="hero-stats" style="margin-bottom: 2rem;">
                <div class="stat-item">
                    <span class="stat-number" id="displayedProducts">0</span>
                    <span class="stat-label">Excipients disponibles</span>
                </div>
            </div>

            <!-- Loading -->
            <div id="catalogLoading" style="text-align: center; padding: 4rem 2rem;">
                <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary);"></i>
                <p style="margin-top: 1rem; color: var(--text-light);">Chargement des excipients...</p>
            </div>

            <!-- R√©sultats -->
            <div id="catalogResults" style="display: none;">
                <div class="products-grid" id="productsGrid"></div>
            </div>

            <!-- Message si aucun r√©sultat -->
            <div id="noResults" style="display: none; text-align: center; padding: 4rem 2rem;">
                <i class="fas fa-search" style="font-size: 4rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                <h3 style="color: var(--text-light);">Aucun excipient trouv√©</h3>
                <p style="color: var(--text-light);">Essayez une autre recherche</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>ChemistrySpot</h3>
                    <p>La marketplace B2B de r√©f√©rence pour les mati√®res premi√®res pharmaceutiques.</p>
                </div>
                
                <div class="footer-column">
                    <h3>Contact</h3>
                    <p>Email: contact@chemistryspot.com</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 ChemistrySpot. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="./js/supabase-config.js"></script>
    <script>
        let allExcipients = [];
        let filteredExcipients = [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üì¶ Chargement du catalogue...');
            
            // Attendre ChemSpotDB
            let attempts = 0;
            while (!window.ChemSpotDB && attempts < 20) {
                await new Promise(resolve => setTimeout(resolve, 500));
                attempts++;
            }
            
            if (!window.ChemSpotDB) {
                console.error('‚ùå ChemSpotDB non disponible');
                showError();
                return;
            }
            
            try {
                // Charger excipients
                allExcipients = await window.ChemSpotDB.getAllExcipients();
                filteredExcipients = [...allExcipients];
                
                console.log(`‚úÖ ${allExcipients.length} excipients charg√©s`);
                
                // Afficher
                displayExcipients();
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                showError();
            }
        });

        // Afficher les excipients
        function displayExcipients() {
            const loading = document.getElementById('catalogLoading');
            const results = document.getElementById('catalogResults');
            const noResults = document.getElementById('noResults');
            const grid = document.getElementById('productsGrid');
            
            loading.style.display = 'none';
            
            if (filteredExcipients.length === 0) {
                results.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            results.style.display = 'block';
            noResults.style.display = 'none';
            
            grid.innerHTML = filteredExcipients.map(exc => `
                <div class="product-card fade-in">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="font-size: 1.3rem; color: var(--primary); margin-bottom: 0.5rem;">
                            ${exc.nom_commun}
                        </h3>
                        <span class="product-badge" style="background: var(--success); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem;">
                            Excipient
                        </span>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="display: grid; gap: 0.5rem; font-size: 0.9rem;">
                            <div><strong>Nom chimique:</strong> ${exc.nom_chimique || 'N/A'}</div>
                            <div><strong>CAS:</strong> ${exc.cas_number || 'N/A'}</div>
                            <div><strong>Formule:</strong> ${exc.formule || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem; line-height: 1.5;">
                        <strong>Fonction:</strong> ${exc.fonction_principale || 'Non sp√©cifi√©e'}
                    </div>
                    
                    <button class="btn btn-primary" onclick="viewExcipient(${exc.id})" style="width: 100%;">
                        <i class="fas fa-eye"></i> Voir d√©tails
                    </button>
                </div>
            `).join('');
            
            // Mettre √† jour stats
            document.getElementById('displayedProducts').textContent = filteredExcipients.length;
        }

        // Recherche
        function handleSearch(event) {
            event.preventDefault();
            const query = document.getElementById('catalogSearchInput').value.toLowerCase().trim();
            
            if (!query) {
                filteredExcipients = [...allExcipients];
            } else {
                filteredExcipients = allExcipients.filter(exc => 
                    exc.nom_commun?.toLowerCase().includes(query) ||
                    exc.nom_chimique?.toLowerCase().includes(query) ||
                    exc.cas_number?.toLowerCase().includes(query) ||
                    exc.formule?.toLowerCase().includes(query)
                );
            }
            
            displayExcipients();
        }

        // Voir d√©tails
        function viewExcipient(id) {
            alert(`Fiche d√©taill√©e excipient ID: ${id}\n(Page en construction)`);
        }

        // Afficher erreur
        function showError() {
            document.getElementById('catalogLoading').innerHTML = `
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444;"></i>
                <p style="margin-top: 1rem; color: #ef4444;">Erreur de chargement</p>
            `;
        }
    </script>
</body>
</html>
